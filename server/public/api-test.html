<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Test Page</title>
  <link rel="stylesheet" href="/css/tabler.min.css">
  <style>
    .api-response {
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body class="theme-light">
  <div class="page">
    <div class="page-wrapper">
      <div class="container-xl">
        <div class="page-header d-print-none">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <h2 class="page-title">API Test Panel</h2>
              </div>
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container-xl">
            <div class="row row-deck row-cards">
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">Test Database Connection</h3>
                  </div>
                  <div class="card-body">
                    <button id="test-connection" class="btn btn-primary">Test Connection</button>
                    <div class="mt-3">
                      <div class="api-response border rounded p-3" id="connection-result"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">Users API</h3>
                  </div>
                  <div class="card-body">
                    <div class="d-flex gap-2 mb-3">
                      <button id="get-users" class="btn btn-primary">Get All Users</button>
                      <button id="create-user" class="btn btn-success">Create User</button>
                    </div>
                    <div class="mt-3">
                      <h4>Response:</h4>
                      <div class="api-response border rounded p-3" id="users-result"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12">
                <div class="card">
                  <div class="card-header">
                    <h3 class="card-title">Products API</h3>
                  </div>
                  <div class="card-body">
                    <div class="d-flex gap-2 mb-3">
                      <button id="get-products" class="btn btn-primary">Get All Products</button>
                      <button id="create-product" class="btn btn-success">Create Product</button>
                    </div>
                    <div class="mt-3">
                      <h4>Response:</h4>
                      <div class="api-response border rounded p-3" id="products-result"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Create User Modal -->
  <div class="modal modal-blur fade" id="create-user-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="user-form">
            <div class="mb-3">
              <label class="form-label">Username</label>
              <input type="text" class="form-control" name="username" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" name="password" required>
            </div>
            <div class="row">
              <div class="col-6 mb-3">
                <label class="form-label">First Name</label>
                <input type="text" class="form-control" name="first_name">
              </div>
              <div class="col-6 mb-3">
                <label class="form-label">Last Name</label>
                <input type="text" class="form-control" name="last_name">
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Role</label>
              <select class="form-select" name="role">
                <option value="user">User</option>
                <option value="admin">Admin</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary ms-auto" id="submit-user">Create user</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Create Product Modal -->
  <div class="modal modal-blur fade" id="create-product-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create New Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="product-form">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" name="description" rows="3"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Price</label>
              <input type="number" step="0.01" class="form-control" name="price" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Stock Quantity</label>
              <input type="number" class="form-control" name="stock_quantity" value="0">
            </div>
            <div class="mb-3">
              <label class="form-label">Category</label>
              <input type="text" class="form-control" name="category">
            </div>
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" name="is_featured">
                <label class="form-check-label">Featured Product</label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-link link-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary ms-auto" id="submit-product">Create product</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/tabler.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Test connection
      document.getElementById('test-connection').addEventListener('click', async function() {
        const resultElement = document.getElementById('connection-result');
        resultElement.textContent = 'Loading...';
        
        try {
          const response = await fetch('/api/health');
          const data = await response.json();
          resultElement.textContent = JSON.stringify(data, null, 2);
          
          if (data.databaseConnected) {
            resultElement.classList.add('bg-success-subtle');
            resultElement.classList.remove('bg-danger-subtle');
          } else {
            resultElement.classList.add('bg-danger-subtle');
            resultElement.classList.remove('bg-success-subtle');
          }
        } catch (error) {
          resultElement.textContent = 'Error: ' + error.message;
          resultElement.classList.add('bg-danger-subtle');
          resultElement.classList.remove('bg-success-subtle');
        }
      });
      
      // Get all users
      document.getElementById('get-users').addEventListener('click', async function() {
        const resultElement = document.getElementById('users-result');
        resultElement.textContent = 'Loading...';
        
        try {
          const response = await fetch('/api/users');
          const data = await response.json();
          resultElement.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
          resultElement.textContent = 'Error: ' + error.message;
        }
      });
      
      // Get all products
      document.getElementById('get-products').addEventListener('click', async function() {
        const resultElement = document.getElementById('products-result');
        resultElement.textContent = 'Loading...';
        
        try {
          const response = await fetch('/api/products');
          const data = await response.json();
          resultElement.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
          resultElement.textContent = 'Error: ' + error.message;
        }
      });
      
      // Create user modal
      document.getElementById('create-user').addEventListener('click', function() {
        const modal = new bootstrap.Modal(document.getElementById('create-user-modal'));
        modal.show();
      });
      
      // Submit user form
      document.getElementById('submit-user').addEventListener('click', async function() {
        const form = document.getElementById('user-form');
        const formData = new FormData(form);
        const userData = {
          username: formData.get('username'),
          email: formData.get('email'),
          password_hash: formData.get('password'), // In a real app, you'd hash this
          first_name: formData.get('first_name'),
          last_name: formData.get('last_name'),
          role: formData.get('role')
        };
        
        try {
          const response = await fetch('/api/users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(userData)
          });
          
          const resultElement = document.getElementById('users-result');
          const data = await response.json();
          resultElement.textContent = JSON.stringify(data, null, 2);
          
          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('create-user-modal'));
          modal.hide();
          
          // Reset form
          form.reset();
        } catch (error) {
          console.error('Error creating user:', error);
        }
      });
      
      // Create product modal
      document.getElementById('create-product').addEventListener('click', function() {
        const modal = new bootstrap.Modal(document.getElementById('create-product-modal'));
        modal.show();
      });
      
      // Submit product form
      document.getElementById('submit-product').addEventListener('click', async function() {
        const form = document.getElementById('product-form');
        const formData = new FormData(form);
        const productData = {
          name: formData.get('name'),
          description: formData.get('description'),
          price: parseFloat(formData.get('price')),
          stock_quantity: parseInt(formData.get('stock_quantity')),
          category: formData.get('category'),
          is_featured: formData.get('is_featured') === 'on' ? 1 : 0
        };
        
        try {
          const response = await fetch('/api/products', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(productData)
          });
          
          const resultElement = document.getElementById('products-result');
          const data = await response.json();
          resultElement.textContent = JSON.stringify(data, null, 2);
          
          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('create-product-modal'));
          modal.hide();
          
          // Reset form
          form.reset();
        } catch (error) {
          console.error('Error creating product:', error);
        }
      });
      
      // Initial load
      document.getElementById('test-connection').click();
    });
  </script>
</body>
</html> 